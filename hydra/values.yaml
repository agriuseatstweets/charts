belly:
  image:
    repository: agriuseatstweets/belly
    tag: 0.0.23
  schedule: "5,25,50 * * * *"
  completions: 6
  parallelism: 6
  backoffLimit: 1
  resources:
    requests:
      cpu: "1000m"
      memory: "30Gi"
  keySecret: agrius-belly-keys
  queue:
    queue: "kafka"
    topic: "tweets"
    kafkaBrokers: "hydra-kafka:9092"
    kafkaPollInterval: "1920000"
  belly:
    location: "gs://spain-tweets/datalake"
    size: "360000"
  spark:
    driverMemory: "35g"
    partitionSize: "2000"

bellyback:
  image:
    repository: agriuseatstweets/bellyback
    tag: 0.0.4
  schedule: "*/3 * * * *"
  completions: 5
  parallelism: 5
  backoffLimit: 2
  resources:
    requests:
      memory: "2Gi"
  keySecret: agrius-bellyback-keys
  queue:
    queue: "kafka"
    topic: "tweets"
    kafkaBrokers: "hydra-kafka:9092"
    kafkaPollInterval: "1920000"
  java:
    opts: "-Xmx3072m -Xms256m"
  belly:
    location: "spain-tweets-backup"
    size: "100"

kafka:
  replicas: 6
  imageTag: 5.4.0
  resources:
    requests:
      cpu: "100m"
      memory: "10Gi"
  kafkaHeapOptions: "-Xmx4G -Xms1G"
  configurationOverrides:
    "offsets.topic.replication.factor": 3
    "group.initial.rebalance.delay.ms": 20000
    "auto.create.topics.enable": false
    "auto.leader.rebalance.enable": false
  topics:
    - name: tweets
      config: "retention.ms=864000000,compression.type=snappy" # 10 days
      partitions: 12
      replicationFactor: 3
    - name: ubdata
      config: "retention.ms=432000000,compression.type=snappy" # 5 days
      partitions: 12
      replicationFactor: 2
  persistence:
    size: "1000Gi"
    storageClass: "pd-ssd"
  affinity:
    podAntiAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
      - labelSelector:
          matchExpressions:
          - key: app
            operator: In
            values:
            - kafka
        topologyKey: "kubernetes.io/hostname"
    podAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
       - weight: 50
         podAffinityTerm:
           labelSelector:
             matchExpressions:
             - key: app
               operator: In
               values:
                 - zookeeper
           topologyKey: "kubernetes.io/hostname"
